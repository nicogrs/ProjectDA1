@page "/{teamName}/panels/create"
@using Dominio
@using Dominio.Data
@using Logica
@inject Session Session
@inject PanelDatabase PDatabase
@inject TeamDatabase TDatabase
@inject NavigationManager Navigation

<h3>CreatePanel</h3>

<PageTitle>Create Panel</PageTitle>
<h3>Crear Panel</h3>
<EditForm Model="modelCreatePanel" OnValidSubmit="HandleCreate">
    <DataAnnotationsValidator/>
    <div class="form-group">
        <label id="name">Nombre</label>
        <InputText class="form-control" @bind-Value="@modelCreatePanel.Name" id="name"></InputText>
        <ValidationMessage For="@(() => modelCreatePanel.Name)"/>
    </div>
    <div class="form-group">
        <label id="userAmount">Descripcion</label>
        <InputNumber class="form-control" @bind-Value="@modelCreatePanel.Description" id="userAmount"></InputNumber>
        <ValidationMessage For="@(() => modelCreatePanel.Description)"/>
    </div>
    
    <div class="form-group">
        <button class="btn btn-primary" type="submit">Crear Grupo</button>
    </div>
    <div class="col-4">
        <button class="btn btn-primary" type="submit" @onclick="GoBack">Volver</button>
    </div>
    <div class="alert alert-danger" role="alert">
        @createMessage
    </div>

</EditForm>


    
@code{

    Panel modelCreatePanel = new Panel();
    private List<User> users;
    private string createMessage;
    public List<User> SelectedUser; 
    
    [Parameter]
    public string teamName { get; set; }
    
    protected override void OnInitialized()
    {
        if (Session.CurrentUser==null)
        {
            Navigation.NavigateTo("/error");
        }
    }
    
    private void HandleCreate()
    {
        Panel p = new Panel
        {
            Name = modelCreatePanel.Name,
            Team = TDatabase.GetTeamByName(teamName),
            Description = modelCreatePanel.Description,
            Creator = Session.CurrentUser,
            Tasks = null
        };
        PDatabase.Panels.Add(p);
        Session.GetTeams().Find(x => x.Name == teamName).Panels.Add(p);
        createMessage="Panel agregado con Ã©xito";
    }
    private void GoBack()
    {
        Navigation.NavigateTo($"/{teamName}/panel");
    }
}