@page "/{teamName}/panels/create"
@using Dominio
@using Dominio.Data
@inject Session Session
@inject PanelDatabase PDatabase
@inject TeamDataBase TDatabase
@inject NavigationManager Navigation

<PageTitle>Create Panel</PageTitle>
<h3>Crear Panel</h3>
<EditForm Model="modelCreatePanel" OnValidSubmit="HandleCreate">
    <DataAnnotationsValidator/>
    <div class="form-group">
        <label id="name">Nombre</label>
        <InputText class="form-control" @bind-Value="@modelCreatePanel.Name" id="name"></InputText>
        <ValidationMessage For="@(() => modelCreatePanel.Name)"/>
    </div>
    <div class="form-group">
        <label id="userAmount">Descripcion</label>
        <InputNumber class="form-control" @bind-Value="@modelCreatePanel.Description" id="userAmount"></InputNumber>
        <ValidationMessage For="@(() => modelCreatePanel.Description)"/>
    </div>
    
    <div class="form-group">
        <button class="btn btn-primary" type="submit">Crear Grupo</button>
    </div>
    <div class="col-4">
        <button class="btn btn-primary" type="submit" @onclick="GoBack">Volver</button>
    </div>
    @if (!string.IsNullOrEmpty(message))
    {
        <div class="alert alert-success" role="alert">
            @message
        </div>
    }
</EditForm>

@code{
    [Parameter]
    public string teamName { get; set; }
    
    Panel modelCreatePanel = new Panel();
    private List<User> users;
    private string message;
    private int teamCount = 0;
    
    protected override void OnInitialized()
    {
        if (Session.CurrentUser==null)
        {
            Navigation.NavigateTo("/error");
        }
        teamCount = TDatabase.Teams.Count();
    }
    
    private void HandleCreate()
    {
        Panel p = new Panel("panel", teamCount)
        {
            Name = modelCreatePanel.Name,
            Team = TDatabase.GetTeamByName(teamName).Name,
            Description = modelCreatePanel.Description,
            CreatedBy = Session.CurrentUser,
            Tasks = null
        };
        PDatabase.Panels.Add(p);
        TDatabase.GetTeamByName(teamName).Panels.Add(p);
        message="Panel agregado con Ã©xito";
    }
    
    private void GoBack()
    {
        Navigation.NavigateTo($"/{teamName}/panel");
    }
}